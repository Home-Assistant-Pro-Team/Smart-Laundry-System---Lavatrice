input_number:
  costo_energia_casa:
    name: Costo Energia Casa
    min: 0.000
    max: 99999.000
    unit_of_measurement: "â‚¬"
    step: 0.01
    mode: box
    icon: mdi:currency-eur

template:
  - sensor:
      - name: Cambio volumi alexa
        state: >
          {% from 'personal.jinja' import media_players %}
          {% set alexa = media_players('alexa_media').split() %}
          {{ expand(alexa) | map(attribute='attributes.volume_level') |select('defined') | list}}

      - name: Cambio volumi google
        state: >
          {% from 'personal.jinja' import media_players %}
          {% set google = media_players('cast').split() %}
          {{ expand(google) | map(attribute='attributes.volume_level') |select('defined') | list }}
 
  - trigger:
      - platform: state
        entity_id: sensor.cambio_volumi_google
    sensor:
      - name: Volumi google
        state: "{{ now() }}"
        attributes:
          list_device: >-
            {% from 'personal.jinja' import media_players %}
            {% set google = media_players('cast').split() %}
            {% set this_entity = state_attr('sensor.volumi_google','list_device') %}
            {
              {%- for key in google %}
              {{ '"' ~ key ~ '" : ' }}
                {% if state_attr(key, 'volume_level') is number %}
                  {{ state_attr(key, 'volume_level') }}
                {% elif this_entity[key] is defined and this_entity[key] is number %}
                  {{ this_entity[key] }}  
                {% else %}
                  {{ 0.5 }}
                {% endif %}
              {%- if not loop.last %}, {% endif %}
              {%- endfor %}
            }

  - trigger:
      - platform: state
        entity_id: sensor.cambio_volumi_alexa
    sensor:
      - name: Volumi alexa
        state: "{{ now() }}"
        attributes:
          list_device: >-
            {% from 'personal.jinja' import media_players %}
            {% set alexa = media_players('alexa_media').split() %}
            {% set this_entity = state_attr('sensor.volumi_alexa','list_device') %}
            {
              {%- for key in alexa %}
              {{ '"' ~ key ~ '" : ' }}
                {% if state_attr(key, 'volume_level') is number %}
                  {{ state_attr(key, 'volume_level') }}
                {% elif this_entity[key] is defined and this_entity[key] is number %}
                  {{ this_entity[key] }}  
                {% else %}
                  {{ 0.5 }}
                {% endif %}
              {%- if not loop.last %}, {% endif %}
              {%- endfor %}
            }
